□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■
■概要
□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■
■get_custom-field-templateについて
●私の制作でよくあるお話。
　コンテントを使うとHTMLが必要、ビジュアルだとちょっとした空間が変わったりするので使いたくない。
　会社概要や追加事項を作るときに不便。
　→故にカスタムフィールドを使用することに…（他に方法があるのかもしれませんが…）
　
　カスタムフィールドを作るには、上記案件を自前で用意するのは面倒なので　カスタムフィールドテンプレートを使用（費用削減のため）。


●起きる問題
　・会社概要や追加事項がある場合、post_metaでズレが生じることがある。
　・編集をするとズレがひどくなることがある。
　・テンプレートを変えると使用できない…


●対策としてしたいことを整理
　・とりあえず、ずれなく抽出出来るようにしたい。
　・テンプレートを変更しても利用できるように、コンテント部分で呼び出せるようなショートコードが欲しい。
　・追加事項についても繰り返しで表示できるようなショートコードを設置したい。


●プロセスの流れを整理。
　・良くないけど、SQLにつないでpostmetaデータを抽出。
　・画像の場合は、画像のURLが入るようにする。
　・コンテント内で使用されているショートコードに貼り付けを行う。
　・グループ内では開始の宣言と終了の宣言を出来るようにする。


□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■
■使用方法
□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■
PHPテンプレートとして使用する場合。
$costom = get-custom-field-template($post->ID)
でそれぞれの項目が配列として代入されます。

RestAPIで使用する場合
サイトURL/wp-json/wp/v2/posts/?_embed
にアクセス。
post_metaメタ内に配列としてカスタムフィールドテンプレートで入力した値が記載されます。



□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■
■付属機能
□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■□■
■get_custom-field-templateアップデート情報
・2点のRest-API用のエンドポイントを作成

●カスタムフィールドを基準として並び替えを行う。エンドポイントを作成
アクセスURL：サイトURL/wp-json/wp/v2/custom_order/カスタム投稿タイプ名/カスタム分類名/カスタム分類詳細名/並び替えを行うカスタムフィールド名/並び順（昇順:ASC/降順：DESC）/表示数1ページに表示する項目数

【入力時の注意点】
カスタム投稿タイプ（半角英数字のみ対応）：
通常では「post」カスタム部投稿を使用している場合（投稿とは別にサイドメニューに投稿と同じようなものがあるケース）は、メニューからそのカスタム投稿名をクリックした際にURLで表示される「?post_type=◇◇」の◇◇を記載してください。

カスタム分類名（半角英数字のみ対応）：
カスタム分類名は、カスタム投稿のメニューを押した際に出てくる「カテゴリー」的なものです。この項目名の探し方は、カテゴリー的なものをクリックして表示した際のURL内にある「taxonomy=◇◇」の◇◇を記載を記載してください。

カスタム分類詳細名（半角英数字のみ対応）：
カスタム分類詳細名は、カテゴリの項目的なものです。分類を登録する画面で登録されたスラッグ名をこちらに記載してください。

並び替えを行うカスタムフィールド名（半角英数字のみ対応）：
カスタムフィールド名：これは、記事を作成する際に入力画面の下にある。コンテンツ入力部分とは別の入力画面です。カスタムフィールドテンプレートを使用されている場合は、記事作成画面に「カスタムフィールドテンプレート」と記載されているかと思います。
その入力欄の前にある英語の文字列が「並び替えを行うカスタムフィールド名」となりますので、こちらを記載してください。

並び順（昇順:ASC/降順：DESC）：
表示する際に並び替えを行うオプションです、どちらかを入力してください。

表示数1ページに表示する項目数（半角数字のみ対応）：
表示させる項目の数を半角数字で入力してください。



【取得できるもの】
title:
記事タイトル

thumbs:
サムネイルの元データ画像のURL

minithumbs:
サムネイル加工された画像のURL

link:
記事のリンク先

cat_id:
該当記事に登録しているカテゴリーIDorカスタム分類（タームID）配列として出力されます。

cat_name:
該当記事に登録しているカテゴリー名orカスタム分類（ターム名）配列として出力されます。

cat_slug:
該当記事に登録しているカテゴリースラッグ名orカスタム分類（タームスラッグ名）配列として出力されます。

parent:
該当記事に登録している親カテゴリーIDor親カスタム分類（タームID）配列として出力されます。

cat_links: 該当記事に登録しているカテゴリーリンク先orカスタム分類（タームリンク）配列として出力されます。

該当記事に登録しているカスタムフィードの内容が配列（カスタムフィールド名：入力された内容）として出力されます。





●カテゴリーのand検索を行いながら、カスタムフィールドで並び替えを行い出力をするエンドポイントを作成
アクセスURL：サイトURL/wp-json/wp/v2/categoies_and_search/カテゴリー番号/並び替えを行うカスタムフィールド名/並び替える基準点/並び順（昇順:ASC/降順：DESC）/表示数1ページに表示する項目数/ページ番号

【入力時の注意点】
cat_ids：
カテゴリーのid指定カンマ区切りで入力

metakey：
カスタムフィールドで並び替える場合は、カスタムフィールド名を記載。

orderby：
metakeyがnull意外のものをしている場合。
'meta_value'　これを設定。

それ以外の場合。
'none' - 順序をつけない（バージョン 2.8 以降で使用可能）。
'ID' - 投稿 ID で並び替える。大文字に注意。
'author' - 著者で並び替える。
'title' - タイトルで並び替える。
'date' - 日付で並び替える。
'modified' - 更新日で並び替える。
'parent' - 投稿/固定ページの親ID順。
'rand' - ランダムで並び替える。
'comment_count' - コメント数で並び替える（バージョン 2.9 以降で使用可能）。

order：
'ASC' - 最低から最高へ昇順 (1, 2, 3; a, b, c).
'DESC' - 最高から最低へ降順 (3, 2, 1; c, b, a).

posts_per_pager：
1ページに表示する項目数

paged：
ページ番号


【取得できるもの】
title:
　nomal:記事タイトル名
　tagnone: 記事タイトル名（タグ削除済み）

contents: 
記事内容

excerpt: 
　nomal: 記事抜粋文
　tagnone: 記事抜粋文（タグ削除済み）

thumbs:
サムネイルの元データ画像のURL

minithumbs: 
サムネイル加工された画像のURL

link:
記事のリンク先

categories: {
　cat_id: 該当記事に登録しているカテゴリーID　配列として出力されます。
　cat_name: 該当記事に登録しているカテゴリー名　配列として出力されます。
　cat_slug: 該当記事に登録しているスラッグ名　配列として出力されます。
　parent:　該当記事に登録している親カテゴリーID　配列として出力されます。
　cat_links:　該当記事に登録しているカテゴリーリンク先　配列として出力されます。
 
post_meta: 該当記事に登録しているカスタムフィードの内容が配列（カスタムフィールド名：入力された内容）として出力されます。
--
count: 検索を行った記事数。